<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G6 Cafe - Checkout</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <header>
        <section class="g6logo">
    <div class="g6logo">
        <a href="{{ url_for('home') }}">
            <img src="/static/images/g6logo.png" alt="g6logo">
        </a>
    </div>
</section>

        <nav>
            <a href="{{ url_for('menu') }}">Menu</a>
            <a href="{{ url_for('cart') }}"><img src="{{ url_for('static', filename='images/cart.png') }}" height="50px" width="50"></a>
        </nav>
    </header>

    <section class="checkout">
        <h2>Checkout</h2>
        <div class="checkout-container">
            <!-- Checkout Form -->
            <form id="checkout-form" class="checkout-form" action="#" method="POST">
                <!-- Delivery Address Section (fetched from local storage) -->
                <h3>Delivery Information</h3>
                <div id="delivery_address_section">
                    <label>Address: <input type="text" name="address" id="address" required></label>
                    <label>Pick-up Date<input type="date" name="pickup_date" id="pickup_date"></label>
                    <label>Delivery Date: <input type="date" name="delivery_date" id="delivery_date"></label>
                </div>

                <!-- Personal Details -->
                <h3>Personal Details</h3>
                <label>Name: <input type="text" name="name" required></label>
                <label>Email: <input type="email" name="email"></label>
                <label>Contact Number: <input type="tel" name="contact" required></label>

                <!-- PWD/Senior Citizen Discount Section -->
                <h3>PWD/Senior Citizen Discount</h3>
                <label>
                    <input type="checkbox" id="discount-checkbox"> PWD or Senior Citizen
                </label>
                <div id="discount-details" style="display:none;">
                    <label>Full Name: <input type="text" name="discount_name" placeholder="Enter your full name" required></label>
                    <label>ID Number: <input type="text" name="discount_id_number" placeholder="Enter your ID number" required></label>
                </div>

                <!-- Payment Details -->
                <h3>Payment Option</h3>
                <label>
                    <input type="radio" name="payment" value="cash" id="cash-payment" required>
                    <span>Cash</span>
                </label>
                <!-- Tendered Amount Section (initially hidden) -->
                <div id="tendered-amount-section" style="display: none; margin-left: 20px;">
                    Tendered Amount: <input type="number" name="tendered_amount" id="tendered_amount" placeholder="Enter tendered amount">
                </div>

                <label>
                    <input type="radio" name="payment" value="gcash">
                    <span>GCash (Pay online)</span>
                </label>
                <label>
                    <input type="radio" name="payment" value="debit/creditcard">
                    <span>Debit/Credit Card (Pay online)</span>
                </label>


                <!-- Card Details (hidden by default) -->
                <div id="card-details" class="payment-details">
                    <h4>Card Details</h4>
                    <label>Name on Card: <input type="text" name="card_name" placeholder="Full Name on Card" required></label>
                    <label>Card Number: <input type="text" name="card_number" placeholder="1234 5678 9012 3456" required></label>
                    <div class="expiration-container">
                        <label>Expiration Month:
                            <select name="expiration_month" required>
                                <option value="01">01</option>
                                <option value="02">02</option>
                                <option value="03">03</option>
                                <option value="04">04</option>
                                <option value="05">05</option>
                                <option value="06">06</option>
                                <option value="07">07</option>
                                <option value="08">08</option>
                                <option value="09">09</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                        </label>
                        <label>Expiration Year:
                            <select name="expiration_year" required>
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                                <option value="2029">2029</option>
                                <option value="2030">2030</option>
                                <option value="2031">2031</option>
                                <option value="2032">2032</option>
                            </select>
                        </label>
                    </div>
                    <label>CVV: <input type="text" name="cvv" maxlength="3" placeholder="CVV" required></label>
                </div>

            </form>
        </div>
    </section>

    <!-- Order Summary -->
    <div class="order-summary">
    <div class="order-info">
        <h3>Order Details</h3>
        <h2>Order # <span id="order-number">N/A</span></h2>
    </div>
    <div id="order-summary"></div>

    <div class="order-details">
        <p>Total Items: <span id="total-items">0</span></p>
        <p>Subtotal: <span id="Subtotal">P0.00</span></p>
        <p>Vat: <span id="vat">P0.00</span></p>
        <p>PWD/SENIOR Discount: <span id="discount">P0.00</span></p>
        <p>Amount Due: <span id="amount-due">P0.00</span></p>
        <p id="change-amount">Change: <span id="change-value">P0.00</span></p>
    </div>
</div>

        <button type="submit">Place Order</button>
        <!-- Thank You Modal -->
<div id="thankYouModal" class="modal">
  <div class="modal-content">
    <!-- Add Image at the top -->
    <img src="/static/images/check.png" alt="Checkmark" style="width: 60px; height: 60px; display: block; margin: 0 auto;">

    <h2>Thank you for your Order!</h2>
    <p>We have received your order and have sent you a text <br> message confirmation to {{ customer_phone_number }}</br>.</p>
    <button onclick="redirectToOrderStatus()">OK</button>
  </div>
</div>




</body>
</html>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
    const optionRadioButtons = document.querySelectorAll('input[name="option"]');
    const deliveryAddressSection = document.getElementById("delivery_address_section");
    const paymentRadioButtons = document.querySelectorAll('input[name="payment"]');
    const cardDetailsSection = document.getElementById("card-details");
    const discountCheckbox = document.getElementById("discount-checkbox");
    const discountDetailsSection = document.getElementById("discount-details");
    const cashPaymentRadio = document.getElementById("cash-payment");
    const tenderedAmountSection = document.getElementById("tendered-amount-section");
    const tenderedAmountInput = document.getElementById("tendered_amount");
    const changeDisplay = document.getElementById('change-amount');


    // Initialize the total amount variable globally to be used for calculating change
    let totalAmount = 0;

    // Generate a unique 6-digit order number
    function generateOrderNumber() {
        const randomNum = Math.floor(100000 + Math.random() * 900000);  // Generate a random 6-digit number
        return `${randomNum}`;
    }

    // Show or hide delivery address based on the selected option
    optionRadioButtons.forEach(button => {
        button.addEventListener('change', function() {
            if (this.value === "delivery" || this.value === "scheduled_delivery") {
                deliveryAddressSection.style.display = 'block';
            } else {
                deliveryAddressSection.style.display = 'none';
            }
        });
    });

    // Show or hide card details for debit/credit card payment
    paymentRadioButtons.forEach(button => {
        button.addEventListener('change', function() {
            if (this.value === "debit/creditcard") {
                cardDetailsSection.style.display = 'block';
            } else {
                cardDetailsSection.style.display = 'none';
            }

            // Hide tendered amount section if any payment method other than Cash is selected
            if (this.value !== "cash") {
                tenderedAmountSection.style.display = 'none';
                tenderedAmountInput.value = '';  // Reset the input value
                changeDisplay.style.display = 'none';  // Hide the change display for non-cash payments
            } else {
                tenderedAmountSection.style.display = 'block';  // Show tendered amount section for cash
                changeDisplay.style.display = 'block';  // Show the change display for cash
            }
        });
    });

    // Show/hide discount details (PWD/Senior Citizen)
    discountCheckbox.addEventListener('change', function() {
        if (this.checked) {
            discountDetailsSection.style.display = 'block';
        } else {
            discountDetailsSection.style.display = 'none';
        }
        // Recalculate the cart after the checkbox state changes
        loadCart();
    });

    // Show or hide tendered amount section when Cash is selected
    cashPaymentRadio.addEventListener('change', function() {
        if (this.checked) {
            tenderedAmountSection.style.display = 'block'; // Show tendered amount section when Cash is selected
            changeDisplay.style.display = 'block';  // Show change display when Cash is selected
        } else {
            tenderedAmountSection.style.display = 'none'; // Hide when any other payment method is selected
            tenderedAmountInput.value = '';  // Reset the input value
            changeDisplay.style.display = 'none';  // Hide change display for non-cash payments
        }
    });

    function loadCart() {
    const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    const orderSummary = document.getElementById('order-summary');
    let totalItems = 0;
    let subtotal = 0;
    let vat = 0;
    let discount = 0;

    if (cartItems.length === 0) {
        orderSummary.innerHTML = '<p>Your cart is empty.</p>';
    } else {
        let orderSummaryHtml = '';

        cartItems.forEach(item => {
            const itemSubtotal = item.quantity * item.itemPrice;
            subtotal += itemSubtotal;
            totalItems += item.quantity;

            orderSummaryHtml += `
                <div>
                    <p>${item.itemName} - P${item.itemPrice.toFixed(2)} x ${item.quantity} = P${itemSubtotal.toFixed(2)}</p>
                </div>
            `;
        });

        // Determine discount and VAT
        if (discountCheckbox.checked) {
            // Apply discount (20% of subtotal)
            discount = subtotal * 0.20;

            // VAT is not applied when a discount is present
            vat = 0;
        } else {
            // Apply VAT (12% of subtotal)
            vat = subtotal * 0.12;

            // No discount applied
            discount = 0;
        }

        // Calculate the total amount
        totalAmount = subtotal + vat - discount;

            // Display order summary
            orderSummary.innerHTML = orderSummaryHtml;
            document.getElementById('total-items').innerText = totalItems;
            document.getElementById('Subtotal').innerText = `P${subtotal.toFixed(2)}`;
            document.getElementById('vat').innerText = `P${vat.toFixed(2)}`;
            document.getElementById('discount').innerText = `P${discount.toFixed(2)}`;
            document.getElementById('amount-due').innerText = `P${totalAmount.toFixed(2)}`;

            // Generate and display the order number
            const orderNumber = generateOrderNumber();
            document.getElementById('order-number').innerText = orderNumber;  // Set the order number here
        }

        // Update change when tendered amount changes
        updateChangeDisplay();
    }

    // Function to calculate and display the change
    function updateChangeDisplay() {
        tenderedAmountInput.addEventListener('input', function () {
            const tenderedAmount = parseFloat(this.value); // Get tendered amount
            const amountDue = parseFloat(totalAmount.toFixed(2)); // Use the total amount already displayed

            if (!isNaN(tenderedAmount) && tenderedAmount >= amountDue) {
                const change = tenderedAmount - amountDue; // Calculate change
                changeDisplay.innerText = `Change: P${change.toFixed(2)}`; // Update change display
            } else if (!isNaN(tenderedAmount)) {
                changeDisplay.innerText = `Insufficient funds!`; // Show warning for insufficient funds
            } else {
                changeDisplay.innerText = `Change: P0.00`; // Reset change display if input is invalid
            }
        });
    }
        // Listen for changes to payment methods
        paymentRadioButtons.forEach(button => {
            button.addEventListener('change', function() {
                if (this.value !== "cash") {
                    // If switching away from cash, reset change
                    tenderedAmountInput.value = '';  // Reset the input value
                    changeDisplay.innerText = `Change: P0.00`;  // Reset change display to 0
                    changeDisplay.style.display = 'none';  // Hide the change display
                } else {
                    // If switching to cash, show the change display
                    changeDisplay.style.display = 'block';
                    changeDisplay.innerText = `Change: P0.00`;  // Reset change display to 0
                }
            });
        });
                function showThankYouModal() {
  const modal = document.getElementById("thankYouModal");
  modal.style.display = "block";
}

function showThankYouModal() {
  const modal = document.getElementById("thankYouModal");
  modal.style.display = "block";
}

function closeThankYouModal() {
  const modal = document.getElementById("thankYouModal");
  modal.style.display = "none";
}

function redirectToOrderStatus() {
  // Close the Thank You modal
  closeThankYouModal();

  // Get the order number from the page (this would be dynamically generated or retrieved)
  const orderNumber = document.getElementById('order-number').innerText;

  // Redirect to the order status page with the order number
  window.location.href = `/order-status/${orderNumber}`; // Route to order status page
}

// Trigger the Thank You modal when the "Place Order" button is clicked
document.querySelector("button[type='submit']").addEventListener("click", function(event) {
  event.preventDefault(); // Prevent the default form submission
  showThankYouModal();
});

    // Load cart items and set up change display when the page loads
    loadCart();
});
    </script>
